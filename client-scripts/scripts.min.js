function SmartCanvas(t){this.id=t,this.canvas=document.getElementById(t),this.images={}}function init_background(){var t=new SmartCanvas("battlefield-bg");return t.fill_rect(0,0,t.canvas.width,t.canvas.height,"#954"),t}function init_battlefield(){var t=new SmartCanvas("battlefield");return t.add_image("pirate","captain.png"),t}function render(t){t.clear(),t.draw_pirates(game.pirates)}function HooksGame(t){this.options=t||{},this.pirates=this.options.pirates||[];var a=this.options.rendering||function(){};this._available_names=["John","Arthur","Lorenzo","Charles"],this._starting_positions={John:[0,600],Arthur:[150,600],Lorenzo:[300,600],Charles:[450,600]};setInterval(this.enact_gravity.bind(this,a),100)}function Pirate(t,a,e){this.name=t||"John",this.x=a||0,this.y=e||0}SmartCanvas.prototype.get_context=function(){return this.canvas.getContext("2d")},SmartCanvas.prototype.add_image=function(t,a){var e=new Image;e.src=a,this.images[t]=e},SmartCanvas.prototype.fill_rect=function(t,a,e,i,n){var o=this.get_context();o.fillStyle=n,o.fillRect(t,a,e,i)},SmartCanvas.prototype.clear=function(){this.get_context().clearRect(0,0,this.canvas.width,this.canvas.height)},SmartCanvas.prototype.draw_image=function(t,a){var e=this.images[t],a=a||{},i=(a.coordinates||[0,0],a.x||0),n=a.y||0,o=a.width||e.width,r=a.height||e.height,s=a.background,c=this;e.onload=function(){s&&c.fill_rect(i,n,o,r,s),c.get_context().drawImage(e,i,n,o,r)}},SmartCanvas.prototype.draw_pirates=function(t){var a=this.images.pirate,e=this,i=a.width,n=a.height;t.forEach(function(t){var o=t.name,r=t.x,s=t.y;e.fill_rect(r,s,i,n,pirate_colors[o]),e.get_context().drawImage(a,r,s)})};var pirate_colors={John:"#0099ff",Arthur:"#ffcc00",Lorenzo:"#009900",Charles:"#de1f1f"},socket=io(),background_canvas=init_background(),smart_canvas=init_battlefield(),game,pirate_name,actions=[],actions_counter=0;socket.on("player",function(t){pirate_name=t,console.log("azaza")}),socket.on("data_package",function(t){game?game.pirates=t.pirates:(t.rendering=render.bind(this,smart_canvas),game=new HooksGame(t)),actions=actions.filter(function(a,e){return a.number>t.actions[pirate_name]}),console.log(actions.join("\n"));for(var a=0;a<actions.length;a++)game.teleport_pirate(game.find_pirate_by_name(pirate_name),actions[a].data[0],actions[a].data[1]),console.log("teleporing pirate to x:"+actions[a].data[0]+" y:"+actions[a].data[1]);requestAnimationFrame(render.bind(this,smart_canvas))}),smart_canvas.canvas.addEventListener("click",function(t){var a=t.pageX-smart_canvas.canvas.offsetLeft,e=t.pageY-smart_canvas.canvas.offsetTop;if(pirate_name&&game){game.teleport_pirate(game.find_pirate_by_name(pirate_name),a,e);var i=new Date;actions_counter+=1;var n={type:"click",data:[a,e],time:i.getTime(),name:pirate_name,number:actions_counter};socket.emit("user_input",n),actions.push(n),console.log(actions.join("\n"))}}),HooksGame.prototype.is_room_full=function(){return this.pirates.length>3},HooksGame.prototype.add_new_pirate=function(){if(!this.is_room_full()){var t=this._available_names.shift(),a=this._starting_positions[t],e=new Pirate(t,a[0],a[1]);return this.pirates.push(e),e}},HooksGame.prototype.find_pirate_by_name=function(t){for(var a=null,e=0;e<this.pirates.length;e++)if(this.pirates[e].name===t){a=this.pirates[e];break}return a},HooksGame.prototype.remove_pirate=function(t){this._available_names.unshift(t.name),this.pirates.splice(this.pirates.indexOf(t),1)},HooksGame.prototype.toString=function(){var t=this.pirates.length+" pirate(s) situated in this room.";return this.pirates.forEach(function(a){t+="\n"+a}),t},HooksGame.prototype.enact_gravity=function(t){this.pirates.forEach(function(t){t.y+=1}),t()},HooksGame.prototype.teleport_pirate=function(t,a,e){t.x=a,t.y=e},Pirate.prototype.toString=function(){return"Pirate "+this.name+". Coordinates: x "+this.x+" y "+this.y},Pirate.prototype.get_coordinates=function(){var t=[this.x,this.y];return t},module.exports=HooksGame;